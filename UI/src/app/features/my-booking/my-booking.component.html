<div class="my-booking-container">
  <div class="page-header">
    <h2 class="page-title">My Bookings</h2>
    <a mat-mini-fab color="primary" routerLink="/book" matTooltip="New Booking">
      <mat-icon>add</mat-icon>
    </a>
  </div>

  @if (isLoading) {
    <mat-progress-bar mode="indeterminate" aria-label="Loading bookings"></mat-progress-bar>
  }

  @if (errorMessage) {
    <p class="error-message" role="alert">{{ errorMessage }}</p>
  }

  @if (!isLoading) {
    @if (bookings.length === 0) {
      <mat-card class="empty-state">
        <mat-card-content>
          <mat-icon class="empty-icon">event_busy</mat-icon>
          <p>You have no bookings yet.</p>
          <a mat-mini-fab color="primary" routerLink="/book" matTooltip="Book a Room">
            <mat-icon>add</mat-icon>
          </a>
        </mat-card-content>
      </mat-card>
    } @else {
      <!-- Confirmation banner -->
      @if (confirmCancelId) {
        <mat-card class="confirm-card">
          <mat-card-content>
            <mat-icon color="warn">warning</mat-icon>
            <span>Are you sure you want to cancel this booking?</span>
            <div class="confirm-actions">
              <button mat-mini-fab color="warn" (click)="onCancelConfirm()" matTooltip="Confirm cancellation">
                <mat-icon>check</mat-icon>
              </button>
              <button mat-mini-fab (click)="onCancelDismiss()" matTooltip="Keep booking">
                <mat-icon>close</mat-icon>
              </button>
            </div>
          </mat-card-content>
        </mat-card>
      }

      <mat-table [dataSource]="bookings" class="bookings-table">

        <ng-container matColumnDef="title">
          <mat-header-cell *matHeaderCellDef>Title</mat-header-cell>
          <mat-cell *matCellDef="let b">{{ b.title }}</mat-cell>
        </ng-container>

        <ng-container matColumnDef="office">
          <mat-header-cell *matHeaderCellDef>Office</mat-header-cell>
          <mat-cell *matCellDef="let b">{{ b.officeName }}</mat-cell>
        </ng-container>

        <ng-container matColumnDef="room">
          <mat-header-cell *matHeaderCellDef>Room</mat-header-cell>
          <mat-cell *matCellDef="let b">{{ b.roomName }}</mat-cell>
        </ng-container>

        <ng-container matColumnDef="date">
          <mat-header-cell *matHeaderCellDef>Date</mat-header-cell>
          <mat-cell *matCellDef="let b">{{ b.date }}</mat-cell>
        </ng-container>

        <ng-container matColumnDef="time">
          <mat-header-cell *matHeaderCellDef>Time</mat-header-cell>
          <mat-cell *matCellDef="let b">{{ getTimeRange(b) }}</mat-cell>
        </ng-container>

        <ng-container matColumnDef="status">
          <mat-header-cell *matHeaderCellDef>Status</mat-header-cell>
          <mat-cell *matCellDef="let b">
            @if (b.isCancelled) {
              <mat-chip color="warn" highlighted>Cancelled</mat-chip>
            } @else {
              <mat-chip color="primary" highlighted>Active</mat-chip>
            }
          </mat-cell>
        </ng-container>

        <ng-container matColumnDef="actions">
          <mat-header-cell *matHeaderCellDef></mat-header-cell>
          <mat-cell *matCellDef="let b">
            @if (!b.isCancelled) {
              <button mat-icon-button color="warn"
                      (click)="onCancelClick(b.id)"
                      [disabled]="cancellingId === b.id"
                      [attr.aria-label]="'Cancel booking ' + b.title"
                      matTooltip="Cancel booking">
                <mat-icon>cancel</mat-icon>
              </button>
            }
          </mat-cell>
        </ng-container>

        <mat-header-row *matHeaderRowDef="displayedColumns"></mat-header-row>
        <mat-row *matRowDef="let row; columns: displayedColumns;"
                 [class.cancelled-row]="row.isCancelled"></mat-row>
      </mat-table>
    }
  }
</div>
