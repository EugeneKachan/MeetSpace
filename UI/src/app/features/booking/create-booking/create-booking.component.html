<div class="create-booking-container">
  <div class="page-header">
    <button mat-icon-button (click)="goBack()" aria-label="Back to room selection">
      <mat-icon>arrow_back</mat-icon>
    </button>
    <div>
      <h2 class="page-title">Book a Room</h2>
      <p class="page-subtitle">{{ roomName }} &mdash; {{ officeName }}</p>
    </div>
  </div>

  <mat-card class="booking-card">
    <mat-card-content>
      <form [formGroup]="bookingForm" (ngSubmit)="onSubmit()" class="booking-form">

        <!-- Booking title -->
        <mat-form-field appearance="outline" class="full-width">
          <mat-label>Booking Title</mat-label>
          <input matInput formControlName="title" placeholder="e.g. Team standup" maxlength="200"
                 aria-label="Booking title" />
          <mat-icon matSuffix>title</mat-icon>
          @if (title.invalid && title.touched) {
            <mat-error>Title is required (max 200 characters).</mat-error>
          }
        </mat-form-field>

        <!-- Date -->
        <mat-form-field appearance="outline" class="full-width">
          <mat-label>Date</mat-label>
          <input matInput [matDatepicker]="datePicker" formControlName="date"
                 [min]="minDate" placeholder="Pick a date" aria-label="Booking date" readonly />
          <mat-datepicker-toggle matIconSuffix [for]="datePicker"></mat-datepicker-toggle>
          <mat-datepicker #datePicker></mat-datepicker>
          @if (date.invalid && date.touched) {
            <mat-error>Please select a date.</mat-error>
          }
        </mat-form-field>

        <!-- Start time -->
        <div class="time-row">
          <span class="time-label">Start Time</span>
          <div class="time-selects">
            <mat-form-field appearance="outline" class="time-field">
              <mat-label>Hour</mat-label>
              <mat-select formControlName="startHour" aria-label="Start hour">
                @for (h of hours; track h) {
                  <mat-option [value]="h">{{ formatHour(h) }}</mat-option>
                }
              </mat-select>
            </mat-form-field>

            <span class="time-colon">:</span>

            <mat-form-field appearance="outline" class="time-field">
              <mat-label>Minute</mat-label>
              <mat-select formControlName="startMinute" aria-label="Start minute">
                @for (m of minutes; track m) {
                  <mat-option [value]="m">{{ formatMinute(m) }}</mat-option>
                }
              </mat-select>
            </mat-form-field>
          </div>
        </div>

        <!-- End time -->
        <div class="time-row">
          <span class="time-label">End Time</span>
          <div class="time-selects">
            <mat-form-field appearance="outline" class="time-field">
              <mat-label>Hour</mat-label>
              <mat-select formControlName="endHour" aria-label="End hour">
                @for (h of hours; track h) {
                  <mat-option [value]="h">{{ formatHour(h) }}</mat-option>
                }
              </mat-select>
            </mat-form-field>

            <span class="time-colon">:</span>

            <mat-form-field appearance="outline" class="time-field">
              <mat-label>Minute</mat-label>
              <mat-select formControlName="endMinute" aria-label="End minute">
                @for (m of minutes; track m) {
                  <mat-option [value]="m">{{ formatMinute(m) }}</mat-option>
                }
              </mat-select>
            </mat-form-field>
          </div>
        </div>

        @if (bookingForm.hasError('endNotAfterStart') && bookingForm.touched) {
          <p class="error-message" role="alert">End time must be after start time.</p>
        }

        @if (errorMessage) {
          <p class="error-message" role="alert">{{ errorMessage }}</p>
        }

        @if (isLoading) {
          <mat-progress-bar mode="indeterminate" aria-label="Creating booking"></mat-progress-bar>
        }

        <div class="form-actions">
          <button mat-mini-fab color="primary" type="submit" [disabled]="isLoading"
                  matTooltip="Confirm Booking">
            <mat-icon>event_available</mat-icon>
          </button>
          <button mat-mini-fab type="button" (click)="goBack()" [disabled]="isLoading"
                  matTooltip="Cancel">
            <mat-icon>close</mat-icon>
          </button>
        </div>
      </form>
    </mat-card-content>
  </mat-card>
</div>
